<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/XML/XMLDocument.xml to edit this template
-->



<root>
  -- üìå Criando o banco de dados Condominio
-- Cria o banco de dados "Condominio" se ele n√£o existir
CREATE DATABASE Condominio;
-- Seleciona o banco de dados "Condominio" para ser utilizado
USE Condominio;

drop database Condominio

-- üìå Apagando tabelas se j√° existirem
-- Remove as tabelas caso elas j√° existam no banco de dados
DROP TABLE IF EXISTS ControleReserva;
DROP TABLE IF EXISTS Atividade;
DROP TABLE IF EXISTS Reserva;
DROP TABLE IF EXISTS Chave;
DROP TABLE IF EXISTS Morador;
DROP TABLE IF EXISTS Funcionario;
DROP TABLE IF EXISTS Unidade;

-- üìå Apaga o banco de dados "Condominio" se necess√°rio (n√£o recomendado em produ√ß√£o)
-- DROP DATABASE Condominio;

-- üìå Criando a tabela Unidade
-- Cria a tabela "Unidade", que armazenar√° informa√ß√µes sobre os im√≥veis do condom√≠nio
CREATE TABLE Unidade (
    id_unidade INT PRIMARY KEY IDENTITY (1,3),  -- A coluna 'id_unidade' √© a chave prim√°ria com incremento de 3 em 3
	id_chave INT FOREIGN KEY REFERENCES Chave(id_chave) NOT NULL, -- Refer√™ncia √† unidade √† qual a chave pertence
	tipo VARCHAR(50) NOT NULL,                   -- Tipo do im√≥vel (ex: Apartamento, Casa)
    numero VARCHAR(10) NOT NULL,                 -- N√∫mero da unidade
    bloco VARCHAR(10) NOT NULL,                  -- Bloco da unidade
    capacidade VARCHAR(10) NOT NULL,             -- Capacidade de pessoas da unidade
    descricao VARCHAR(255),                      -- Descri√ß√£o do im√≥vel
    nome VARCHAR(100) ,                  -- Nome do condom√≠nio
    dimensoes VARCHAR(50)                       -- Dimens√µes da unidade                 -- Dimens√µes da unidade
);

-- üìå Criando a tabela Funcionario
-- Cria a tabela "Funcionario", que armazenar√° dados dos funcion√°rios do condom√≠nio
CREATE TABLE Funcionario (
    id_funcionario INT PRIMARY KEY IDENTITY (1,3), -- A coluna 'id_funcionario' √© a chave prim√°ria com incremento de 3 em 3
    nome VARCHAR(100) NOT NULL,                      -- Nome do funcion√°rio
    cpf VARCHAR(14) UNIQUE NOT NULL,                 -- CPF do funcion√°rio (√∫nico)
    telefone VARCHAR(20) NOT NULL,                   -- Telefone do funcion√°rio
    endereco VARCHAR(200) NOT NULL,                  -- Endere√ßo do funcion√°rio
    departamento VARCHAR(100) NOT NULL,              -- Departamento do funcion√°rio (ex: Seguran√ßa, Manuten√ß√£o)
    senha VARCHAR(255)                               -- Senha de acesso do funcion√°rio
);

-- üìå Criando a tabela Morador
-- Cria a tabela "Morador", que armazenar√° dados dos moradores do condom√≠nio
CREATE TABLE Morador (
    id_morador INT PRIMARY KEY IDENTITY (1,3), -- A coluna 'id_morador' √© a chave prim√°ria com incremento de 3 em 3
    id_unidade INT FOREIGN KEY REFERENCES Unidade (id_unidade) NOT NULL, -- Refer√™ncia √† tabela Unidade, associando o morador √† unidade
    nome VARCHAR(100) NOT NULL, -- Nome do morador
    cpf VARCHAR(14) UNIQUE NOT NULL, -- CPF do morador (√∫nico)
    email VARCHAR(100) NOT NULL, -- Email do morador
    data_nasc  VARCHAR(10) NOT NULL -- Data de nascimento do morador
);

-- üìå Criando a tabela Chave
-- Cria a tabela "Chave", que armazenar√° informa√ß√µes sobre as chaves das unidades
CREATE TABLE Chave (
    id_chave INT PRIMARY KEY IDENTITY (1,3), -- A coluna 'id_chave' √© a chave prim√°ria com incremento de 3 em 3
    nome VARCHAR(50) NOT NULL -- Nome da chave (ex: Chave da piscina)
);

-- üìå Criando a tabela Reserva
-- Cria a tabela "Reserva", que gerenciar√° as reservas de chaves pelos moradores
CREATE TABLE Reserva (
    id_reserva INT PRIMARY KEY IDENTITY (1,3), -- A coluna 'id_reserva' √© a chave prim√°ria com incremento de 3 em 3
    id_chave INT FOREIGN KEY (id_chave) REFERENCES Chave(id_chave) NOT NULL, -- Chave que est√° sendo reservada
    id_morador INT FOREIGN KEY (id_morador) REFERENCES Morador(id_morador) NOT NULL, -- Morador que fez a reserva
    id_unidade INT FOREIGN KEY (id_unidade) REFERENCES Unidade(id_unidade) NOT NULL, -- Unidade relacionada √† reserva
    id_funcionario INT FOREIGN KEY (id_funcionario) REFERENCES Funcionario(id_funcionario) NOT NULL, -- Funcion√°rio que gerencia a reserva
    data_reserva DATE NOT NULL, -- Data da reserva
    statu VARCHAR(20) NOT NULL DEFAULT 'pendente' -- Status da reserva (ex: pendente, aprovada, cancelada)
);

-- üìå Criando a tabela Atividade
-- Cria a tabela "Atividade", que armazenar√° atividades realizadas pelos funcion√°rios
CREATE TABLE Atividade (
    id_atividade INT PRIMARY KEY IDENTITY (1,3), -- A coluna 'id_atividade' √© a chave prim√°ria com incremento de 3 em 3
    id_funcionario INT FOREIGN KEY (id_funcionario) REFERENCES Funcionario(id_funcionario) NOT NULL, -- Funcion√°rio respons√°vel pela atividade
    nome VARCHAR(100) NOT NULL, -- Nome da atividade
    descricao VARCHAR(255), -- Descri√ß√£o da atividade
    datas DATE NOT NULL, -- Data da atividade
    statu VARCHAR(20) DEFAULT 'pendente' -- Status da atividade (ex: pendente, conclu√≠da)
);

-- üìå Criando a tabela ControleReserva
-- Cria a tabela "ControleReserva", que gerencia a entrega e devolu√ß√£o das chaves
CREATE TABLE ControleReserva (
    id_controleReserva INT PRIMARY KEY IDENTITY (1,3), -- A coluna 'id_controleReserva' √© a chave prim√°ria com incremento de 3 em 3
    id_reserva INT FOREIGN KEY (id_reserva) REFERENCES Reserva(id_reserva) NOT NULL, -- Refer√™ncia √† reserva associada
    data_entrega VARCHAR(100) NOT NULL, -- Data de entrega da chave
    data_devolucao VARCHAR(100), -- Data de devolu√ß√£o da chave
    funcionario_entrega VARCHAR(100) NOT NULL, -- Funcion√°rio respons√°vel pela entrega
    funcionario_devolucao VARCHAR(100) -- Funcion√°rio respons√°vel pela devolu√ß√£o
);

-- Inserindo dados na tabela Unidade
-- Insere dados de exemplo na tabela "Unidade", representando os im√≥veis do condom√≠nio
INSERT INTO Unidade (id_chave,tipo, numero, bloco, capacidade, descricao, nome, dimensoes)
VALUES
(1,'Apartamento', '101', 'A', '4', 'Apartamento t√©rreo', 'Residencial Alpha', '80m¬≤'),
(4,'Casa', 'B12', 'B', '6', 'Casa com quintal', 'Condom√≠nio Verde', '120m¬≤'),
(7,'Apartamento', '305', 'C', '3', 'Apartamento com vista', 'Residencial Beta', '90m¬≤');
SELECT* FROM Unidade;
-- Inserindo dados na tabela Funcionario
-- Insere dados de exemplo na tabela "Funcionario", representando os funcion√°rios do condom√≠nio
INSERT INTO Funcionario (nome, cpf, telefone, endereco, departamento, senha)
VALUES
('Robertin', '400.289.231-04', '(11) 92156-7890', 'Rua Perola, 789', 'Porteiro', 'port123'),
('Bolt Wirtz', '145.654.801-03', '(11) 9678-7901', 'Rua dos Couves, 194', 'Sindico', 'adm123'),
('Carlos Souza', '123.456.789-01', '(11) 98765-4321', 'Rua das Flores, 123', 'Seguran√ßa', 'senha123'),
('Mariana Lima', '987.654.321-02', '(11) 91234-5678', 'Av. Central, 456', 'Administra√ß√£o', 'admin456'),
('Roberto Alves', '111.222.333-44', '(11) 93456-7890', 'Rua Verde, 789', 'Manuten√ß√£o', 'manut789');

-- Inserindo dados na tabela Morador
-- Insere dados de exemplo na tabela "Morador", associando os moradores √†s unidades
INSERT INTO Morador (id_unidade, nome, cpf, email, data_nasc)
VALUES
(7, 'Ana Pereira', '555.666.777-88', 'ana@email.com', '1985-07-15'),
(1, 'Jo√£o Mendes', '999.888.777-66', 'joao@email.com', '1990-02-25'),
(4, 'Fernanda Costa', '444.333.222-11', 'fernanda@email.com', '1982-11-10');

SELECT*FROM Morador;

-- Inserindo dados na tabela Chave
-- Insere dados de exemplo na tabela "Chave", associando as chaves √†s unidades
INSERT INTO Chave
VALUES
('Chave do sal√£o de festas'),
('Chave da piscina'),
('Chave da garagem');

-- Inserindo dados na tabela Reserva
-- Insere dados de exemplo na tabela "Reserva", criando algumas reservas
INSERT INTO Reserva (data_reserva, statu)
VALUES
('2025-02-10', 'pendente'),
('2025-02-12', 'aprovada'),
('2025-02-15', 'cancelada');

-- Inserindo dados na tabela Atividade
-- Insere dados de exemplo na tabela "Atividade", representando algumas atividades no condom√≠nio
INSERT INTO Atividade (nome, descricao, datas, statu)
VALUES
('Troca de l√¢mpadas', 'Substitui√ß√£o das l√¢mpadas queimadas nas √°reas comuns', '2025-02-05', 'conclu√≠da'),
('Ronda noturna', 'Monitoramento da seguran√ßa do condom√≠nio', '2025-02-06', 'pendente'),
('Reuni√£o com moradores', 'Discuss√£o sobre novas regras do condom√≠nio', '2025-02-07', 'conclu√≠da');

-- Inserindo dados na tabela ControleReserva
-- Insere dados de exemplo na tabela "ControleReserva", controlando a entrega e devolu√ß√£o das chaves
INSERT INTO ControleReserva (id_reserva,funcionario_entrega,data_entrega, funcionario_devolucao,data_devolucao )
VALUES
(1,'Carlos Souza','2025-02-10', NULL,NULL),
(4, 'Mariana Lima','2025-02-12', 'Roberto Alves','2025-02-13');

-- üìå Consultando a tabela Unidade
SELECT * FROM Unidade;

-- üìå Consultando a tabela Funcionario
SELECT * FROM Funcionario;

-- üìå Consultando a tabela Morador
SELECT * FROM Morador;

-- üìå Consultando a tabela Chave
SELECT * FROM Chave;

-- üìå Consultando a tabela Reserva
SELECT * FROM Reserva;--fazer um inner join para aprovar ou n√£o uma reserva

-- üìå Consultando a tabela Atividade
SELECT * FROM Atividade;

-- üìå Consultando a tabela ControleReserva
SELECT * FROM ControleReserva;--fazer inner join 

delete from chave where id_chave > 7 

--inner Join para Reserva
SELECT m.nome as Morador ,u.nome as Unidade ,f.nome as Funcionario,c.nome as Chave ,v.data_reserva as Data_reserva,v.statu as Sttatus 
FROM Reserva v INNER JOIN Morador m  ON v.id_morador =m.id_morador 
INNER JOIN unidade u ON v.id_unidade = u.id_unidade 
INNER JOIN Funcionario f ON v.id_funcionario = f.id_funcionario
INNER JOIN chave c ON v.id_chave = c.id_chave;

--Inner Join para Controle reserva
SELECT cr.id_controleReserva, m.nome AS nome_morador, cr.data_entrega, cr.data_devolucao , cr.funcionario_entrega, cr.funcionario_devolucao
FROM ControleReserva cr
INNER JOIN Reserva r ON cr.id_reserva = r.id_reserva
INNER JOIN Morador m ON r.id_morador = m.id_morador;

delete from ControleReserva where funcionario_entrega = 'Mariana Lima'

SELECT id_unidade,id_chave,numero,tipo,bloco,nome,capacidade FROM Unidade WHERE tipo = 'Espa√ßo de evento'
SELECT id_unidade,id_chave,nome,tipo,numero,bloco,capacidade FROM Unidade where tipo = 'Espa√ßo de evento' AND nome LIKE ?

SELECT 
    m.nome AS Morador,
    u.nome AS Unidade,
    f.nome AS Funcionario,
    c.nome AS Chave,
    v.data_reserva AS Data_reserva,
    v.statu AS Status
FROM Reserva v
INNER JOIN Morador m ON v.id_morador = m.id_morador
INNER JOIN Unidade u ON v.id_unidade = u.id_unidade
INNER JOIN Funcionario f ON v.id_funcionario = f.id_funcionario
INNER JOIN Chave c ON v.id_chave = c.id_chave
WHERE v.statu = 'pendente';

update Reserva set statu = ? where id_Reserva = ?

UPDATE r
SET r.statu = ?
FROM Reserva r
INNER JOIN Morador m ON r.id_morador = m.id_morador
INNER JOIN Unidade u ON r.id_unidade = u.id_unidade
WHERE m.nome = ? and u.nome = ?;


</root>

